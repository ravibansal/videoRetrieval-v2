# videoRetrieval-v2
## Instruction for the data to be used:
1. Please make sure that the video-sentence ratio is constant. 
2. Make different .npy files for train and test data using the below preprocessing files. The resulting feature files will be:
    1. vid_feats_train.npy
    2. sent_feats_train.npy
    3. vid_feats_test.npy
    4. sent_feats_test.npy
## extract_video_embeddings.py : 
To extract video feature of size [80 4096] for all the videos in a given path and save it into a provided path. (using pre-trained VGG16 model). Download pretrianed npy file from https://mega.nz/#!YU1FWJrA!O1ywiCS2IiOlUCtCpI6HTJOMrneN-Qdv3ywQP5poecM
## extract_sentence_embeddings.py :
To extract sentence feature of size [4800] for all the sentences in a given .txt file and save it into a provided path (as .npy file).
### -- Requirements: <br />
Please follow https://github.com/ryankiros/skip-thoughts to dowload pre-trained skip-thought model. Please keep extract_sentence_embeddings.py python file in the same directory as skipthoughts.py
<br />
### --usage: 
python extract_sentence_embeddings.py <sentence_input_file> <sentence_feature_file.npy>
<br />
## union_video_embeddings.py :
To take union of all the video features generated by extract_video_embeddings.py and create one .npy file of size [num of videos, 80, 4096].
<br />
### --usage:
python union_video_embeddings.py <video_feature_folder> <video_feature_file.npy>
## train_embedding_nn.py :
To train the two branch network on the train data with the input as video feature and sentence feature path. It will checkpoint the model for last n timestamps in provided checkpoint directory.
### --usage:
python train_embedding_nn.py \
    --video_feat_path ./vid_feats.npy \
    --sent_feat_path ./sent_feats.npy \
    --save_dir ./checkpoint/
## eval_embedding_nn.py :
To evaluate the model for test data with the input as video feature and sentence feature path. It will restore the model from checkpoint directory and use it produce recall@K(1, 5, 10) values for vid2sent and sent2vid.
### --usage:
python eval_embedding_nn.py \
    --video_feat_path ./vid_feats_test.npy  \
    --sent_feat_path ./sent_feats_test.npy \
    --restore_path ./checkpoint/-4081.meta
